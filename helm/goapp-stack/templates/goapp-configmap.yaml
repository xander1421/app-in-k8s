apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-goapp-config
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "goapp-stack.labels" . | nindent 4 }}
data:
  # Server configuration
  PORT: {{ .Values.goapp.port | quote }}
  ENVIRONMENT: {{ .Values.goapp.env.ENVIRONMENT | default "production" | quote }}
  TLS_ENABLED: {{ .Values.goapp.http3.enabled | default false | quote }}

  # Redis Sentinel configuration (Spotahome Redis Operator)
  REDIS_SENTINEL_ADDR: {{ include "goapp-stack.redis.sentinelHost" . }}:26379
  REDIS_MASTER_NAME: {{ .Values.goapp.env.REDIS_MASTER_NAME | default "mymaster" | quote }}

  # Elasticsearch connection (ECK)
  ELASTICSEARCH_URL: {{ include "goapp-stack.elasticsearch.url" . | quote }}

  # File upload configuration
  UPLOAD_DIR: "/data/uploads"
  MAX_UPLOAD_SIZE: {{ .Values.goapp.env.MAX_UPLOAD_SIZE | default "104857600" | quote }}
