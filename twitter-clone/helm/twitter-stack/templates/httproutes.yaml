{{- if .Values.gateway.enabled }}
---
# User Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: user-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/users
      backendRefs:
        - name: user-service
          port: {{ .Values.services.userService.port }}
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/lookup
      backendRefs:
        - name: user-service
          port: {{ .Values.services.userService.port }}

---
# Tweet Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: tweet-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/tweets
      backendRefs:
        - name: tweet-service
          port: {{ .Values.services.tweetService.port }}

---
# Timeline Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: timeline-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/timeline
      backendRefs:
        - name: timeline-service
          port: {{ .Values.services.timelineService.port }}

---
# Media Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: media-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/media
      backendRefs:
        - name: media-service
          port: {{ .Values.services.mediaService.port }}

---
# Search Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: search-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/search
      backendRefs:
        - name: search-service
          port: {{ .Values.services.searchService.port }}
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/trending
      backendRefs:
        - name: search-service
          port: {{ .Values.services.searchService.port }}

---
# Notification Service Routes
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: notification-service-routes
  namespace: {{ .Values.namespace }}
spec:
  parentRefs:
    - name: twitter-gateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/notifications
      backendRefs:
        - name: notification-service
          port: {{ .Values.services.notificationService.port }}
{{- end }}
